name: C++ Reaktoro

on: [push]

env:
  BUILD_TYPE: Release

jobs:
  build:

    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v1
      
    - name: Setting up conda
      run: |
        conda_install.sh
        export "CFLAGS=-I$CONDA_PREFIX/include $CFLAGS"
        export "CXXFLAGS=-I$CONDA_PREFIX/include $CXXFLAGS"
        echo -e "\n\nCurrent compiler configuration:\nCXX=$CXX\nCC=$CC\nCFLAGS=$CFLAGS\nCXXFLAGS=$CXXFLAGS"
        echo -e "\nCurrent packages:"
        $CONDA list
      shell: bash
      
    - name: Create Build Directory
      run: mkdir build
      working-directory: ${{runner.workspace}}
      shell: bash
    
    - name: Configure CMake
      run: |
        inv -e compile -n $NUMBER_OF_COMPILATION_JOBS
        python ci/check_compiled_files.py
        pytest -n auto -ra -vv .
      working-directory: ${{runner.workspace}}/build
      shell: bash
